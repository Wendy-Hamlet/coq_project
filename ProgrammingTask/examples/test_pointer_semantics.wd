# Test file for new pointer semantics
# Tests: pointer-integer conversion, pointer comparison, pointer subtraction, &(*ptr)

# ====================
# 1. Pointer-Integer Conversion (Explicit Cast Required)
# ====================

int x;
int* ptr;
long long addr;

x = 100;
ptr = &x;

# Explicit pointer to integer conversion (OK)
addr = (long long)ptr;

# Explicit integer to pointer conversion (OK)
ptr = (int*)addr;

# ====================
# 2. Pointer Comparison Operators
# ====================

int a;
int b;
int* p1;
int* p2;
long* p3;
int result;

a = 10;
b = 20;
p1 = &a;
p2 = &b;

# Equality comparison of same type pointers (OK)
if (p1 == p2) then {
    result = 0
} else {
    result = 1
};

# Inequality comparison of same type pointers (OK)
if (p1 != p2) then {
    result = 1
} else {
    result = 0
};

# Relational comparison of same type pointers (OK)
if (p1 < p2) then {
    result = 1
} else {
    result = 0
};

if (p1 <= p2) then {
    result = 1
} else {
    result = 0
};

# Compare pointer with cast null (OK)
if (p1 == (int*)0) then {
    result = 0
} else {
    result = 1
};

# ====================
# 3. Pointer Subtraction Returns long long
# ====================

int arr1;
int arr2;
int* pa1;
int* pa2;
long long diff;

arr1 = 1;
arr2 = 2;
pa1 = &arr1;
pa2 = &arr2;

# Pointer subtraction returns long long (OK)
diff = pa1 - pa2;

# Can assign to any integer type with implicit conversion
result = pa1 - pa2;

# ====================
# 4. Extended & Operator (Works on Lvalues)
# ====================

int val;
int* ptr_val;
int** pptr;

val = 42;
ptr_val = &val;

# Traditional: address of variable (OK)
pptr = &ptr_val;

# Extended: address of dereference expression (OK)
# &(*pptr) has type int**, same as pptr
pptr = &(*pptr);

# Multiple levels (OK)
int** pptr2;
int*** ppptr;
pptr2 = &ptr_val;
ppptr = &pptr2;
ppptr = &(*ppptr)
